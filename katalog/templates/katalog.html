{% extends 'base.html' %}
{% block content %}
    <div class="container mt-5" style="padding-bottom: 30px;">
        <h1 class="mb-4">Page Turn</h1>

        <!-- <div class="row">
            <div class="col-md-6">
                <h5>Name:</h5>
                <p>{{ name }}</p>

                <h5>Class:</h5>
                <p>{{ class }}</p>

                <h5>Anda memiliki {{ products_count }} produk</h5>
            </div> -->
        </div>

   
    <div class="row mt-4">
        <div class="col-md-6">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">Add Product</button>
        </div>
    </div>
</div>

<!-- Add Product Modal -->
<!-- Modal -->
<div class="modal fade" id="addBookModal" tabindex="-1" role="dialog" aria-labelledby="addBookModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addBookModalLabel">Add Book</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form method="post" action="{% url 'add_book' %}">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="name">Name:</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="author">Author:</label>
                        <input type="text" class="form-control" id="author" name="author" required>
                    </div>
                    <div class="form-group">
                        <label for="rating">User Rating:</label>
                        <input type="number" step="0.1" class="form-control" id="rating" name="rating" required>
                    </div>
                    <div class="form-group">
                        <label for="review">Reviews:</label>
                        <input type="number" class="form-control" id="review" name="review" required>
                    </div>
                    <div class="form-group">
                        <label for="price">Price:</label>
                        <input type="number" class="form-control" id="price" name="price" required>
                    </div>
                    <div class="form-group">
                        <label for="year">Year:</label>
                        <input type="number" class="form-control" id="year" name="year" required>
                    </div>
                    <div class="form-group">
                        <label for="genre">Genre:</label>
                        <input type="text" class="form-control" id="genre" name="genre" required>
                    </div>
                    <div class="form-group">
                        <label for="image">Image URL:</label>
                        <input type="text" class="form-control" id="image" name="image" required>
                    </div>
                    <div class="form-group">
                        <label for="description">Description:</label>
                        <textarea class="form-control" id="description" name="description" rows="4" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Add</button>
                </form>
            </div>
        </div>
    </div>
</div>
    
<script>
    async function getProducts() {
        return fetch("{% url 'katalog:get_book_json' %}").then((res) => res.json());
    }

    async function refreshProducts() {
        const books = await getProducts();
        const productCards = document.getElementById("product_cards");
        productCards.innerHTML = "";

        books.forEach((book, index) => {
            const card = document.createElement("div");
            card.classList.add("col-md-4", "mb-4");
            card.innerHTML = `
                <div class="card">
                    <img src="${book.fields.image}" class="card-img-top" alt="Book Cover">
                    <div class="card-body">
                        <h5 class="card-title">${book.fields.name}</h5>
                        <p class="card-text"><b>Author:</b> ${book.fields.author}</p>
                        <p class="card-text"><b>User Rating:</b> ${book.fields.rating}</p>
                        <p class="card-text"><b>Reviews:</b> ${book.fields.review}</p>
                        <p class="card-text"><b>Price:</b> $${book.fields.price}</p>
                        <p class="card-text"><b>Year:</b> ${book.fields.year}</p>
                        <p class="card-text"><b>Genre:</b> ${book.fields.genre}</p>
                        <p class="card-text"><b>Description:</b> ${book.fields.description}</p>
                    </div>
                </div>
            `;

            productCards.appendChild(card);
        });
    }

    refreshProducts();

    function addProduct() {
        fetch("{% url 'main:add_product_ajax' %}", {
            method: "POST",
            body: new FormData(document.querySelector('#form'))
        }).then(refreshProducts);

        document.getElementById("form").reset();
        return false;
    }

    document.getElementById("button_add").onclick = addProduct;
 
</script>

{% endblock content %}
